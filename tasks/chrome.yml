---
- name: Ensure /etc/apt/keyrings exists
  ansible.builtin.file:
    path: /etc/apt/keyrings
    state: directory
    owner: root
    group: root
    mode: "0755"

- name: Download Google Linux signing key
  ansible.builtin.get_url:
    url: "https://dl.google.com/linux/linux_signing_key.pub"
    dest: /tmp/google-linux-signing-key.pub
    mode: "0644"

- name: Dearmor key into keyring
  ansible.builtin.command:
    cmd: "gpg --dearmor -o /etc/apt/keyrings/google-linux.gpg /tmp/google-linux-signing-key.pub"
  args:
    creates: /etc/apt/keyrings/google-linux.gpg

- name: Add Google Chrome APT source (Deb822)
  ansible.builtin.copy:
    dest: /etc/apt/sources.list.d/google-chrome.sources
    owner: root
    group: root
    mode: "0644"
    content: |
      Types: deb
      URIs: https://dl.google.com/linux/chrome/deb/
      Suites: stable
      Components: main
      Architectures: amd64
      Signed-By: /etc/apt/keyrings/google-linux.gpg

- name: Install Google Chrome
  ansible.builtin.apt:
    name: google-chrome-stable
    state: present
    update_cache: true
